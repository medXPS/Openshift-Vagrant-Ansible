- hosts: all
  tasks:
    - name: Ensure git is installed
      package:
        name: git
        state: present

    - name: Clone openshift-ansible repository
      git:
        repo: https://github.com/openshift/openshift-ansible
        dest: ~/openshift-ansible
        force: yes
        update: yes
        recursive: yes
        version: release-4.17
      become: yes
      become_user: vagrant

    - name: Ensure EPEL release is installed
      package:
        name: epel-release
        state: present

    - name: Disable EPEL repo by default
      replace:
        dest: /etc/yum.repos.d/epel.repo
        regexp: '^enabled=1'
        replace: 'enabled=0'

    - name: Install required packages from EPEL
      yum:
        name: ['ansible', 'pyOpenSSL']
        enablerepo: epel
        state: present